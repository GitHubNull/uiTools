# 构建和打包

<cite>
**本文档引用的文件**  
- [pom.xml](file://pom.xml)
- [Main.java](file://src/main/java/org/oxff/Main.java)
- [README.md](file://README.md)
- [CLAUDE.md](file://CLAUDE.md)
</cite>

## 目录
1. [简介](#简介)
2. [构建命令详解](#构建命令详解)
3. [pom.xml关键配置](#pomxml关键配置)
4. [不同环境下的构建建议](#不同环境下的构建建议)
5. [常见构建问题及解决方案](#常见构建问题及解决方案)

## 简介
本文档详细介绍了uiTools项目的构建和打包操作指南。该项目是一个基于Java Swing的图形界面工具，用于处理字符串格式化、编解码操作以及XML/JSON数据的XPath和JSONPath表达式提取。项目使用Maven进行构建和依赖管理，支持Java 11+环境。通过本指南，开发者可以了解如何使用Maven命令进行项目构建、打包和运行，以及如何配置pom.xml文件来优化构建过程。

## 构建命令详解

### 生成可执行JAR文件
使用`mvn clean package`命令可以清理之前的构建产物并生成可执行的JAR文件。该命令会执行以下操作：
- `clean`：清理target目录，删除之前构建生成的文件
- `package`：编译源代码，运行测试，并将项目打包成JAR文件

构建完成后，可执行JAR文件将位于`target/`目录下，文件名为`uiTools-1.1.8.jar`。

**Section sources**
- [pom.xml](file://pom.xml#L1-L106)
- [README.md](file://README.md#L63-L65)

### 直接运行应用
使用`mvn exec:java -Dexec.mainClass="org.oxff.Main"`命令可以直接运行应用程序，无需先打包成JAR文件。该命令通过Maven的exec插件直接调用主类的main方法。

此命令特别适用于开发和调试阶段，可以快速验证代码更改的效果。

**Section sources**
- [pom.xml](file://pom.xml#L1-L106)
- [Main.java](file://src/main/java/org/oxff/Main.java#L13-L25)
- [README.md](file://README.md#L70-L72)

### 跳过测试以加快构建速度
在开发过程中，如果需要快速构建而不运行测试，可以使用`-DskipTests`参数：

```bash
mvn clean package -DskipTests
```

这个参数会跳过所有测试的执行，从而显著加快构建速度。需要注意的是，这仅跳过测试的执行，但仍然会编译测试代码。

**Section sources**
- [README.md](file://README.md#L215-L217)
- [CLAUDE.md](file://CLAUDE.md#L22-L24)

## pom.xml关键配置

### 依赖管理
pom.xml文件中定义了项目所需的所有依赖项，包括：
- **Gson**：用于JSON处理
- **dom4j**：用于XML处理
- **Apache Commons Codec**：用于Base64/Base32编码/解码
- **FlatLaf**：用于现代化界面主题
- **RSyntaxTextArea**：用于语法高亮的文本编辑器
- **Jayway JsonPath**：用于JSONPath表达式处理
- **Jaxen**：用于XPath表达式处理

这些依赖项确保了项目能够支持各种字符串格式化、编解码和数据提取功能。

**Section sources**
- [pom.xml](file://pom.xml#L20-L65)

### Shade插件配置
项目使用maven-shade-plugin来创建可执行的JAR文件。该插件的关键配置包括：

```xml
<plugin>
    <groupId>org.apache.maven.plugins</groupId>
    <artifactId>maven-shade-plugin</artifactId>
    <version>3.5.0</version>
    <executions>
        <execution>
            <phase>package</phase>
            <goals>
                <goal>shade</goal>
            </goals>
            <configuration>
                <transformers>
                    <transformer implementation="org.apache.maven.plugins.shade.resource.ManifestResourceTransformer">
                        <mainClass>org.oxff.Main</mainClass>
                    </transformer>
                </transformers>
            </configuration>
        </execution>
    </executions>
</plugin>
```

shade插件的作用是将所有依赖项打包到一个JAR文件中（即"fat jar"），并设置主类，使得JAR文件可以直接通过`java -jar`命令运行。

**Section sources**
- [pom.xml](file://pom.xml#L84-L104)

### 可执行JAR入口点设置
在maven-shade-plugin的配置中，通过ManifestResourceTransformer指定了主类：

```xml
<mainClass>org.oxff.Main</mainClass>
```

这会将主类信息写入JAR文件的MANIFEST.MF文件中，使得JAR文件成为可执行的。Main类是应用程序的入口点，负责初始化UI和启动应用程序。

**Section sources**
- [pom.xml](file://pom.xml#L96-L98)
- [Main.java](file://src/main/java/org/oxff/Main.java#L13-L25)

## 不同环境下的构建建议

### 开发环境
在开发环境中，建议使用以下命令进行快速构建和测试：

```bash
# 快速构建，跳过测试
mvn clean package -DskipTests

# 直接运行应用进行测试
mvn exec:java -Dexec.mainClass="org.oxff.Main"
```

这些命令可以快速验证代码更改，提高开发效率。

### 生产环境
在生产环境中，建议执行完整的构建流程，包括所有测试：

```bash
# 完整构建，包含所有测试
mvn clean package
```

确保所有测试通过后再部署应用，以保证代码质量。

### 持续集成环境
在持续集成环境中，可以结合使用不同的Maven命令来优化构建流程：

```bash
# 分阶段构建
mvn clean compile          # 只编译
mvn test                   # 只运行测试
mvn package                # 打包
```

这种分阶段的方式可以更好地控制构建过程，并在出现问题时快速定位。

**Section sources**
- [README.md](file://README.md#L209-L217)
- [CLAUDE.md](file://CLAUDE.md#L13-L24)

## 常见构建问题及解决方案

### Java版本不兼容
**问题**：构建时出现Java版本错误。

**解决方案**：确保使用Java 11或更高版本。在pom.xml中已指定Java 11为目标版本：

```xml
<properties>
    <maven.compiler.source>11</maven.compiler.source>
    <maven.compiler.target>11</maven.compiler.target>
</properties>
```

### 依赖项下载失败
**问题**：Maven无法下载某些依赖项。

**解决方案**：
1. 检查网络连接
2. 清理Maven本地仓库缓存
3. 尝试使用国内镜像源

### 构建速度慢
**问题**：完整构建耗时较长。

**解决方案**：
1. 使用`-DskipTests`参数跳过测试
2. 使用增量构建
3. 确保有足够的内存分配给Maven

### 可执行JAR无法运行
**问题**：生成的JAR文件无法通过`java -jar`命令运行。

**解决方案**：
1. 检查pom.xml中maven-shade-plugin的配置是否正确
2. 确认主类路径是否正确
3. 检查是否有缺失的依赖项

**Section sources**
- [README.md](file://README.md#L220-L245)
- [CLAUDE.md](file://CLAUDE.md#L13-L24)