# 核心功能详解

<cite>
**Referenced Files in This Document**   
- [JsonFormatOperation.java](file://src/main/java/org/oxff/operation/JsonFormatOperation.java)
- [XmlFormatOperation.java](file://src/main/java/org/oxff/operation/XmlFormatOperation.java)
- [UrlEncodeOperation.java](file://src/main/java/org/oxff/operation/UrlEncodeOperation.java)
- [Md5HashOperation.java](file://src/main/java/org/oxff/operation/Md5HashOperation.java)
- [AutoInputOperation.java](file://src/main/java/org/oxff/operation/AutoInputOperation.java)
- [Operation.java](file://src/main/java/org/oxff/operation/Operation.java)
- [OperationCategory.java](file://src/main/java/org/oxff/core/OperationCategory.java)
- [Base64EncodeOperation.java](file://src/main/java/org/oxff/operation/Base64EncodeOperation.java)
- [Sha256HashOperation.java](file://src/main/java/org/oxff/operation/Sha256HashOperation.java)
</cite>

## 目录
1. [格式化操作](#格式化操作)
2. [编解码操作](#编解码操作)
3. [哈希操作](#哈希操作)
4. [自动化操作](#自动化操作)

## 格式化操作

格式化操作模块包含JsonFormatOperation和XmlFormatOperation两个核心类，分别负责JSON和XML数据的美化输出与节点提取。这两个类实现了统一的Operation接口，通过Gson和dom4j库提供强大的格式化功能。

### JSON格式化实现机制

JsonFormatOperation类利用Gson库实现JSON数据的格式化处理。在基础的美化输出功能中，该类通过GsonBuilder创建带有setPrettyPrinting()配置的Gson实例，将紧凑的JSON字符串转换为具有良好缩进和换行的可读格式。当输入无效的JSON格式时，会捕获JsonSyntaxException异常并返回相应的错误信息。

该类还提供了增强的execute方法，支持通过JSONPath表达式提取特定节点数据。实现机制包括：首先使用Gson验证输入JSON的有效性，然后通过JsonPath库解析表达式，遍历匹配的节点并将其转换为字符串结果。对于列表类型的返回结果，会逐个处理其中的元素；对于复杂对象，则使用Gson进行序列化。异常处理策略包括捕获PathNotFoundException以跳过未找到的路径，以及其他表达式相关的异常。

**Section sources**
- [JsonFormatOperation.java](file://src/main/java/org/oxff/operation/JsonFormatOperation.java#L15-L122)

### XML格式化实现机制

XmlFormatOperation类基于dom4j库实现XML数据的格式化处理。其核心实现通过DocumentHelper.parseText()方法解析输入的XML字符串，创建Document对象。然后使用OutputFormat.createPrettyPrint()创建美观打印格式，并通过XMLWriter将格式化后的XML写入StringWriter，最终返回具有适当缩进和换行的美化XML字符串。

该类同样支持XPath表达式提取功能，通过document.selectNodes()和document.selectSingleNode()方法执行XPath查询。实现中包含了对节点类型的判断处理：元素节点返回文本内容，属性/文本/CDATA节点返回字符串值，其他类型节点返回完整的XML表示。异常处理策略包括捕获DocumentException以处理无效的XML格式，以及在表达式执行失败时提供详细的错误信息。

**Section sources**
- [XmlFormatOperation.java](file://src/main/java/org/oxff/operation/XmlFormatOperation.java#L18-L126)

## 编解码操作

编解码操作模块包含多种编码和解码功能，通过Apache Commons Codec库和Java标准库实现。这些操作被统一归类为ENCODING_DECODING类别，每个操作类都实现了Operation接口，提供标准化的执行方法。

### URL编解码实现

UrlEncodeOperation和UrlDecodeOperation类分别负责URL编码和解码操作。UrlEncodeOperation通过调用URLEncoder.encode()方法，将输入字符串按照UTF-8字符集进行编码，将特殊字符转换为%xx格式。UrlDecodeOperation则使用URLDecoder.decode()方法进行反向解码。这两个操作都属于OperationCategory.ENCODING_DECODING分类，确保在用户界面中被正确归类。

**Section sources**
- [UrlEncodeOperation.java](file://src/main/java/org/oxff/operation/UrlEncodeOperation.java#L10-L25)
- [UrlDecodeOperation.java](file://src/main/java/org/oxff/operation/UrlDecodeOperation.java#L10-L25)

### Base64编解码实现

Base64EncodeOperation和Base64DecodeOperation类实现了Base64编码和解码功能。Base64EncodeOperation使用Apache Commons Codec库的Base64.encodeBase64String()方法，将输入字符串的UTF-8字节数组编码为Base64字符串。Base64DecodeOperation则使用Base64.decodeBase64()方法进行解码，并将结果字节数组转换回UTF-8字符串。异常处理机制包括捕获解码过程中的任何异常，并返回带有错误信息的描述性消息。

**Section sources**
- [Base64EncodeOperation.java](file://src/main/java/org/oxff/operation/Base64EncodeOperation.java#L10-L25)
- [Base64DecodeOperation.java](file://src/main/java/org/oxff/operation/Base64DecodeOperation.java#L10-L30)

### 其他编解码实现

系统还提供了Base32、Hex和Unicode的编解码功能。Base32操作使用Apache Commons Codec的Base32类进行编码和解码。HexEncodeOperation将输入字符串转换为十六进制表示，通过遍历每个字节并格式化为两位十六进制数，不足两位的补零。HexDecodeOperation则执行反向操作，先验证输入是否为有效的十六进制字符串，然后将其转换回原始字节。Unicode编码将非ASCII字符转换为\uXXXX格式，而Unicode解码则将\uXXXX序列转换回相应的Unicode字符。

**Section sources**
- [Base32EncodeOperation.java](file://src/main/java/org/oxff/operation/Base32EncodeOperation.java#L10-L26)
- [Base32DecodeOperation.java](file://src/main/java/org/oxff/operation/Base32DecodeOperation.java#L10-L31)
- [HexEncodeOperation.java](file://src/main/java/org/oxff/operation/HexEncodeOperation.java#L9-L37)
- [HexDecodeOperation.java](file://src/main/java/org/oxff/operation/HexDecodeOperation.java#L9-L47)
- [UnicodeEncodeOperation.java](file://src/main/java/org/oxff/operation/UnicodeEncodeOperation.java#L7-L30)
- [UnicodeDecodeOperation.java](file://src/main/java/org/oxff/operation/UnicodeDecodeOperation.java#L7-L39)

## 哈希操作

哈希操作模块提供了多种哈希算法实现，包括MD5、SHA1和SHA256。这些操作都属于OperationCategory.HASHING分类，通过Apache Commons Codec库的DigestUtils工具类生成消息摘要。

### 哈希生成机制

Md5HashOperation、Sha1HashOperation和Sha256HashOperation类的实现机制非常相似，都通过调用DigestUtils对应的静态方法（md5Hex、sha1Hex、sha256Hex）来生成输入字符串的哈希值。这些方法将输入字符串转换为字节数组，应用相应的哈希算法，并将结果以十六进制字符串形式返回。由于这些操作是纯计算型的，通常不会抛出异常，因此不需要复杂的异常处理机制。

**Section sources**
- [Md5HashOperation.java](file://src/main/java/org/oxff/operation/Md5HashOperation.java#L8-L23)
- [Sha1HashOperation.java](file://src/main/java/org/oxff/operation/Sha1HashOperation.java#L8-L23)
- [Sha256HashOperation.java](file://src/main/java/org/oxff/operation/Sha256HashOperation.java#L8-L23)

## 自动化操作

自动化操作模块由AutoInputOperation类实现，提供键盘模拟输入功能，属于OperationCategory.AUTOMATION分类。该操作具有独特的功能边界和执行机制。

### 功能边界与实现

AutoInputOperation的功能边界包括：延迟输入、字符间隔控制、输入源选择（输入框或剪贴板）以及特殊字符处理。执行流程首先显示一个配置对话框，允许用户设置延迟时间、字符间隔和输入源。如果用户取消操作，返回"操作已取消"消息。

实现机制中，该操作在SwingUtilities.invokeLater()调用的新线程中执行，避免阻塞UI线程。performAutoInput方法首先根据配置获取要输入的文本，如果选择剪贴板作为输入源，则从系统剪贴板读取文本。然后使用TimeUnit.SECONDS.sleep()延迟指定时间，再通过Robot类模拟键盘输入。

对于特殊字符如换行符和Tab键，直接使用keyPress和keyRelease方法模拟按键。对于普通字符，采用更可靠的剪贴板粘贴方式：将单个字符放入剪贴板，然后模拟Ctrl+V快捷键进行粘贴，这提高了输入的准确性和兼容性。字符间通过TimeUnit.MILLISECONDS.sleep()保持指定的间隔。

异常处理策略包括：捕获剪贴板无文本数据的异常、输入文本为空的异常，并在UI上显示相应的错误消息。所有执行信息和错误都会通过JOptionPane.showMessageDialog()反馈给用户。

**Section sources**
- [AutoInputOperation.java](file://src/main/java/org/oxff/operation/AutoInputOperation.java#L16-L192)